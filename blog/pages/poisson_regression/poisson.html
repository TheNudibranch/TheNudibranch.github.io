<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bayesian Decision Analysis with Poisson Regression and Metropolis-Hastings</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
	<a class="navbar-brand" href="../../../index.html">Ian Costley Homepage</a>
  <div class="container">
  	<!-- <a class="navbar-brand" href="../../../index.html">Ian Costley Homepage</a> -->
    <div class="navbar-header">
      <!-- NOTE: add "navbar-inverse" class for an alternate navbar background -->
      <!-- <a class="navbar-brand" href="../../../index.html">Ian Costley Homepage</a> -->
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="https://github.com/TheNudibranch">GitHub</a></li>
        <li><a href="https://www.linkedin.com/in/ian-s-costley/">LinkedIn</a></li>
        <li><a href="../../blog.html">B<sub>natural</sub>LOG</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Bayesian Decision Analysis with Poisson Regression and Metropolis-Hastings</h1>

</div>


<div id="a-fishy-situation" class="section level2">
<h2>A fishy situation</h2>
<p>Allow me to paint a picture:</p>
<p>You’re an avid salmon fisherman and statistician. You’ve fished 100 ponds in the surrounding area and have recorded the hourly rate at which you catch salmon while on the water. During your time on the water you also record a couple of measurable variables for each pond: pond depth and dissolved oxygen.</p>
<p>Now, your friend Danny wants go fishing with you this week and suggests two ponds you haven’t fished a before. Also, since Danny is a good friend, they have kindly measured both depth and dissolved oxygen of each pond. Very thoughtful! The question now stands: which pond will you catch more salmon at?</p>
</div>
<div id="data-generation" class="section level2">
<h2>Data generation</h2>
<p>Lets assume that the number of salmon caught <span class="math inline">\(Y\)</span> is poisson distributed with rate <span class="math inline">\(\lambda\)</span>. <span class="math display">\[Y \sim Poi(\lambda)\]</span></p>
<p>Let us also assume that the log rate of catching salmon is a linear function of the two pond variables:</p>
<p><span class="math display">\[\log(\lambda) =  \beta_{depth}\cdot x_{depth} + \beta_{oxy}\cdot x_{oxy} + \beta_0\]</span> Finally, we may write the probability of catching <span class="math inline">\(y\)</span> salmon during one hour of fishing given the above parameters:</p>
<p><span class="math display">\[P(y|x_i;\beta_{depth},\beta_{oxy},\beta_0)=\frac{\lambda^y}{y!}e^{-\lambda}, \hspace{4mm} \lambda=\exp(\beta_{depth}\cdot x_{depth} + \beta_{oxy}\cdot x_{oxy} + \beta_0)\]</span> Now, let’s generate some data!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to standardize data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>standardize <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># Number of ponds fished at</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>x_oxy <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">5</span>, <span class="dv">1</span>) <span class="co"># Dissolved oxygen in mg per Liter</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>x_depth <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(N, <span class="dv">30</span>, <span class="dv">10</span>)) <span class="co"># Pond depth</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>b_oxy <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>b_depth <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.6</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>b_int <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(b_oxy<span class="sc">*</span><span class="fu">standardize</span>(x_oxy) <span class="sc">+</span> b_depth<span class="sc">*</span><span class="fu">standardize</span>(x_depth) <span class="sc">+</span> b_int)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">length</span>(lambda), <span class="at">lambda =</span> lambda)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_oxy, y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&#39;darkblue&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Fish Caught Per Hour&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Dissolved Oxygen (mg/L)&#39;</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_depth, y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&#39;darkred&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Fish Caught Per Hour&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Pond Depth (m)&#39;</span>)</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="mcmc-with-metropolis-hastings" class="section level2">
<h2>MCMC with Metropolis Hastings</h2>
<div id="theory" class="section level3">
<h3>Theory</h3>
<div id="model-definition" class="section level4">
<h4>Model Definition</h4>
<p>First, we will assume that the parameters <span class="math inline">\(\beta_{depth}\)</span>, <span class="math inline">\(\beta_{oxy}\)</span>, and <span class="math inline">\(\beta_0\)</span> are independent of each other such that the joint probability distribution for the parameters can be expressed as:</p>
<p><span class="math display">\[P(\beta_{depth}, \beta_{oxy}, \beta_0 ) = P(\beta_{depth} ) \cdot P(\beta_{oxy})\cdot P(\beta_0)\]</span></p>
<p>Now, observing the data from the plots above, we can assume that <span class="math inline">\(\beta_{depth}\)</span> will be positive and <span class="math inline">\(\beta_{oxy}\)</span> to be negative. Thus, we can set out priors to reflect this observation:</p>
<p><span class="math display">\[\begin{align}
Y &amp;\sim Poi(\lambda) \\
\log(\lambda) &amp;=  \beta_{depth}\cdot x_{depth} + \beta_{oxy}\cdot x_{oxy} + \beta_0 \\
\beta_{depth} &amp;\sim N(0.5, 0.5) \\
\beta_{oxy} &amp;\sim N(-0.5,0.5) \\
\beta_0 &amp;\sim N(0, 0.5)
\end{align}\]</span></p>
<p>Let’s now define our likelihood and priors in R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>log_poi_liklihood <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  lam_cands <span class="ot">&lt;-</span> <span class="fu">exp</span>(params[[<span class="st">&#39;b_oxy_cand&#39;</span>]]<span class="sc">*</span><span class="fu">standardize</span>(x_oxy) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                     params[[<span class="st">&#39;b_depth_cand&#39;</span>]]<span class="sc">*</span><span class="fu">standardize</span>(x_depth) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                     params[[<span class="st">&#39;b_int_cand&#39;</span>]])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">dpois</span>(y, lam_cands, <span class="at">log=</span>T)))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>log_prior <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(params[[<span class="st">&#39;b_oxy_cand&#39;</span>]], <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="at">log=</span>T) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(params[[<span class="st">&#39;b_depth_cand&#39;</span>]], <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="at">log=</span>T) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(params[[<span class="st">&#39;b_int_cand&#39;</span>]], <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="at">log=</span>T)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>log_posterior_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(params){</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">log_prior</span>(params) <span class="sc">+</span> <span class="fu">log_poi_liklihood</span>(params))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>While defining our priors it is always good practice to make sure that they make sense by checking the prior predictive distribution. We can do this by taking some samples from our prior distributions and using them in place of our model.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n_prior_samples <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sample_priors <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rnorm</span>(n_prior_samples, <span class="fl">0.5</span>, <span class="fl">0.5</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n_prior_samples, <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rnorm</span>(n_prior_samples, <span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>prior_predicitive <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">standardize</span>(x_oxy), <span class="fu">standardize</span>(x_depth)) <span class="sc">%&gt;%</span> <span class="fu">apply</span>(., <span class="dv">1</span>, <span class="cf">function</span>(x) </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpois</span>(<span class="at">n=</span>n_prior_samples, <span class="fu">exp</span>(x[<span class="dv">1</span>]<span class="sc">*</span>sample_priors[,<span class="dv">1</span>] <span class="sc">+</span> x[<span class="dv">2</span>]<span class="sc">*</span>sample_priors[,<span class="dv">2</span>] <span class="sc">+</span> sample_priors[,<span class="dv">3</span>]) ))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(prior_predicitive <span class="sc">%&gt;%</span> <span class="fu">log</span>(),<span class="at">prob=</span>T,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.8</span>), <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&#39;Log of Prior Predictive and y&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y <span class="sc">%&gt;%</span> <span class="fu">log</span>(), <span class="at">prob=</span>T, <span class="at">add=</span>T, <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkred&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="fu">c</span>(<span class="st">&#39;Prior Predidictive&#39;</span>,<span class="st">&#39;y&#39;</span>), <span class="at">fill=</span><span class="fu">c</span>(<span class="fu">adjustcolor</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">adjustcolor</span>(<span class="st">&#39;darkred&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>)))</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="mcmc" class="section level4">
<h4>MCMC</h4>
<p>Metropolis Hastings is rejection sampler defined as the following.</p>
<p>Suppose we have some sampled value <span class="math inline">\(x_t\)</span> and some function <span class="math inline">\(P(x)\)</span> the returns the probability of a given <span class="math inline">\(x\)</span>. We also have some proposal function that generates a new <span class="math inline">\(x_{t+1}\)</span> given a previously sampled <span class="math inline">\(x_t\)</span> defined by <span class="math inline">\(g(x_{t+1}|x_t)\)</span>.</p>
<p>Now, we need some way to “reject” or “accept” some newly generated <span class="math inline">\(x_{t+1}\)</span> value from our function <span class="math inline">\(g\)</span>. Define this probability of acceptance to be</p>
<p><span class="math display">\[a=\frac{P(x_{t+1})g(x_t|x_{t+1})}{P(x_t)g(x_{t+1}|x_t)}\]</span> Usually (and for our case today), we’ll choose a function <span class="math inline">\(g\)</span> such that <span class="math inline">\(g\)</span> is symmetric, or <span class="math inline">\(g(x_t|x_{t+1})=g(x_{t+1}|x_t)\)</span>. A common choice to achieve this property would be to assume <span class="math inline">\(g\)</span> is normal with mean equal to the given point. In other words <span class="math display">\[g(x_t|x_{t+1})\sim N(x_{t+1},\sigma)\]</span></p>
<p>Note, here <span class="math inline">\(P(x)\)</span> will be the probability of our sampled <span class="math inline">\(\{\beta_{depth}, \beta_{oxy}, \beta_0 \}\)</span> given our data, as that is the posterior we which to rejection sample from.</p>
<p>Now, let’s write our MCMC algorithm and sample from our posterior! We run 4 different chains to get the best estimate of our posterior.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>N_chains <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>mcmc_chain <span class="ot">&lt;-</span> <span class="cf">function</span>(N_sim, explore_param){</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  curr_params <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">b_oxy_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">b_depth_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">b_int_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  chain <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>N_sim, <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim){</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    cand_params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">b_oxy_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, curr_params[[<span class="st">&#39;b_oxy_cand&#39;</span>]], explore_param),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">b_depth_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, curr_params[[<span class="st">&#39;b_depth_cand&#39;</span>]], explore_param),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">b_int_cand =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, curr_params[[<span class="st">&#39;b_int_cand&#39;</span>]], explore_param)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, <span class="fu">exp</span>(<span class="fu">log_posterior_prob</span>(cand_params) <span class="sc">-</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">log_posterior_prob</span>(curr_params)))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (u <span class="sc">&lt;=</span> a){</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>      chain[i,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cand_params)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      curr_params <span class="ot">&lt;-</span> cand_params</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      chain[i,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(curr_params)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(chain)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>simulation <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_chains){</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  simulation[[<span class="fu">paste0</span>(<span class="st">&#39;chain_&#39;</span>,i)]] <span class="ot">&lt;-</span> <span class="fu">mcmc_chain</span>(N_sim, <span class="at">explore_param =</span> <span class="fl">0.01</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>burn <span class="ot">&lt;-</span> <span class="fl">3e4</span></span></code></pre></div>
</div>
</div>
<div id="analyzing-our-chains" class="section level3">
<h3>Analyzing our chains</h3>
<p>Let’s see how well our posteriors match the actual values:</p>
<p><img src="poisson_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Focusing on <span class="math inline">\(\beta_{oxy}\)</span>, let’s see how well our chain converged using rank plots:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> simulation <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(., <span class="cf">function</span>(x) x[<span class="sc">-</span><span class="fu">seq</span>(<span class="dv">1</span>,burn),<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">rank</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(., <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="fu">hist</span>(a[,i], <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>), <span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&#39;Chain_&#39;</span>,i),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /> Rank plots are calculated by combining all our MCMC samples and finding each samples respective rank. The resulting ranks are separated back into their respective chains and plotted as histograms. If the MCMC sampler converged and the chains mixed well without a high degree of autocorrelation, we can expected uniform distributions for each rank plot.</p>
<p>There a couple of metrics we can look at to assess the convergence of our MCMC sampling. One main metric is <span class="math inline">\(\hat{R}\)</span>. It tells us how well all our chains converged and mixed. A good rule of thumb is to have <span class="math inline">\(\hat{R}\)</span> under 1.05.</p>
<p>The other metrics have to do with effective sample size (ESS). In MCMC sampling, we are assuming a level of independence for samples not directly adjacent. In other words, we are hoping for a low degree of autocorrelation. Simply put, if we have a high degree of autocorrelation in our samples then we effectively have less information describing our posterior. This is what ESS measures, the degree of autocorrelation in our chains. The first, bulk-ESS tells us how well the center or bulk of our posterior has been sampled. The second is tail-ESS, which tells us how well our posterior tails were sampled. A good rule of thumb is to have a bulk-ESS and tail-ESS greater than 400.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>metric_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span><span class="dv">3</span>, <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  metric_mat[<span class="dv">1</span>,i] <span class="ot">&lt;-</span> <span class="fu">Rhat</span>(simulation <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(., <span class="cf">function</span>(x) x[<span class="sc">-</span><span class="fu">seq</span>(<span class="dv">1</span>,burn), i]) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()) <span class="sc">%&gt;%</span> <span class="fu">round</span>(.,<span class="dv">2</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  metric_mat[<span class="dv">2</span>,i] <span class="ot">&lt;-</span> <span class="fu">ess_bulk</span>(simulation <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(., <span class="cf">function</span>(x) x[<span class="sc">-</span><span class="fu">seq</span>(<span class="dv">1</span>,burn), i]) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()) <span class="sc">%&gt;%</span> <span class="fu">round</span>(.,<span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  metric_mat[<span class="dv">3</span>,i] <span class="ot">&lt;-</span> <span class="fu">ess_tail</span>(simulation <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(., <span class="cf">function</span>(x) x[<span class="sc">-</span><span class="fu">seq</span>(<span class="dv">1</span>,burn), i]) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()) <span class="sc">%&gt;%</span> <span class="fu">round</span>(.,<span class="dv">1</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(metric_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;b_oxy&#39;</span>, <span class="st">&#39;b_depth&#39;</span>, <span class="st">&#39;b_0&#39;</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(metric_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;r_hat&#39;</span>, <span class="st">&#39;bulk_ess&#39;</span>, <span class="st">&#39;tail_ess&#39;</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(metric_mat, <span class="at">align =</span> <span class="st">&#39;ccc&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">b_oxy</th>
<th align="center">b_depth</th>
<th align="center">b_0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">r_hat</td>
<td align="center">1.0</td>
<td align="center">1.0</td>
<td align="center">1.0</td>
</tr>
<tr class="even">
<td align="left">bulk_ess</td>
<td align="center">2031.8</td>
<td align="center">2014.0</td>
<td align="center">1193.1</td>
</tr>
<tr class="odd">
<td align="left">tail_ess</td>
<td align="center">4640.0</td>
<td align="center">4357.2</td>
<td align="center">2468.5</td>
</tr>
</tbody>
</table>
<p>A good measure to determine how well model fits our data is to plot the posterior predictive against the observed data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>posterior_predictive <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">standardize</span>(x_oxy), <span class="fu">standardize</span>(x_depth)) <span class="sc">%&gt;%</span> <span class="fu">apply</span>(., <span class="dv">1</span>, <span class="cf">function</span>(x) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpois</span>(<span class="at">n=</span>n_prior_samples, <span class="fu">exp</span>(x[<span class="dv">1</span>]<span class="sc">*</span>posterior_oxy <span class="sc">+</span> x[<span class="dv">2</span>]<span class="sc">*</span>posterior_depth <span class="sc">+</span> posterior_int))) <span class="sc">%&gt;%</span> <span class="fu">c</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior_predictive,<span class="at">prob=</span>T, <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks=</span><span class="fu">length</span>(<span class="fu">unique</span>(posterior_predictive)),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&#39;Posterior Predictive and y&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y, <span class="at">prob=</span>T, <span class="at">add=</span>T, <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkred&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>), <span class="at">breaks=</span><span class="dv">34</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="fu">c</span>(<span class="st">&#39;Posterior Predictive&#39;</span>,<span class="st">&#39;y&#39;</span>), <span class="at">fill=</span><span class="fu">c</span>(<span class="fu">adjustcolor</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">adjustcolor</span>(<span class="st">&#39;darkred&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>)))</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="decision-analysis" class="section level2">
<h2>Decision Analysis</h2>
<p>Back to the question at hand: what pond should you fish at? Let’s say your friend Danny has the following measurements for the two ponds in question.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">Dissolved Oxygen</th>
<th align="center">Pond Depth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pond A</td>
<td align="center">8</td>
<td align="center">40</td>
</tr>
<tr class="even">
<td align="left">Pond B</td>
<td align="center">7</td>
<td align="center">20</td>
</tr>
</tbody>
</table>
<p>From our posterior samples, we can obtain distributions representing our uncertainty for the fish we will catch at each of the ponds in question.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pond_a <span class="ot">&lt;-</span> ((ponds<span class="sc">$</span><span class="st">`</span><span class="at">Dissolved Oxygen</span><span class="st">`</span>[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(x_oxy)) <span class="sc">/</span> <span class="fu">sd</span>(x_oxy)) <span class="sc">*</span> posterior_oxy <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  ((ponds<span class="sc">$</span><span class="st">`</span><span class="at">Pond Depth</span><span class="st">`</span>[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">mean</span>(x_depth)) <span class="sc">/</span> <span class="fu">sd</span>(x_depth)) <span class="sc">*</span> posterior_depth <span class="sc">+</span> posterior_int</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>pond_a <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">length</span>(pond_a), <span class="fu">exp</span>(pond_a))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pond_a, <span class="at">breaks=</span><span class="fu">length</span>(<span class="fu">unique</span>(pond_a)), <span class="at">prob=</span>T, <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;darkgreen&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&#39;Pond A&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Fish Caught&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>pond_b <span class="ot">&lt;-</span> ((ponds<span class="sc">$</span><span class="st">`</span><span class="at">Dissolved Oxygen</span><span class="st">`</span>[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">mean</span>(x_oxy)) <span class="sc">/</span> <span class="fu">sd</span>(x_oxy)) <span class="sc">*</span> posterior_oxy <span class="sc">+</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ((ponds<span class="sc">$</span><span class="st">`</span><span class="at">Pond Depth</span><span class="st">`</span>[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">mean</span>(x_depth)) <span class="sc">/</span> <span class="fu">sd</span>(x_depth)) <span class="sc">*</span> posterior_depth <span class="sc">+</span> posterior_int</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>pond_b <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">length</span>(pond_b), <span class="fu">exp</span>(pond_b))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pond_b, <span class="at">breaks=</span><span class="fu">length</span>(<span class="fu">unique</span>(pond_b)), <span class="at">prob=</span>T, <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;yellow&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&#39;Pond B&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Fish Caught&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now, we can take the difference of the two distributions and come to our conclusion.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pond_diff <span class="ot">&lt;-</span> (pond_b <span class="sc">-</span> pond_a)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pond_diff, <span class="at">prob=</span>T, <span class="at">main=</span><span class="st">&#39;Pond B - Pond A&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Difference in fish caught between ponds&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&#39;purple&#39;</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="poisson_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If we want to find the expected increase in fish in choosing pond B of pond A, it’s as simple as taking the average of our above distribution.</p>
<pre><code>## [1] 3.110529</code></pre>
<p>Hence, after our extensive analysis we can come to the conclusion that it is best to choose Pond B over A. Although, maybe your friend Danny has left by now!</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
